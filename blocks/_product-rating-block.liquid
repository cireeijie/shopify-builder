{%- liquid 
  assign total_reviews = 0

  for review in block.settings.product.metafields.custom.product_reviews.value
    assign total_reviews = total_reviews | plus: 1
  endfor
-%}

{%- style -%}
  #shopify-block-{{ block.id }} {
    margin: {{ block.settings.margin_top_desktop }}px {{ block.settings.margin_right_desktop }}px {{ block.settings.margin_bottom_desktop }}px {{ block.settings.margin_left_desktop }}px;
    padding: {{ block.settings.padding_top_desktop }}px {{ block.settings.padding_right_desktop }}px {{ block.settings.padding_bottom_desktop }}px {{ block.settings.padding_left_desktop }}px;
    {%- if block.settings.custom_width_desktop != blank -%}
      width: {{ block.settings.custom_width_desktop }}px;
    {%- elsif block.settings.width_desktop > 0 -%}
      width: {{ block.settings.width_desktop }}px;
    {%- endif -%}
  }

  #shopify-block-{{ block.id }} .product-rating-stars {
    display: flex;
    align-items: center;
    gap: 5px;
    line-height: 1;
    font-size: 13px;
    color: {{ block.settings.text_color }};
  }

  #shopify-block-{{ block.id }} .star-svg {
    color: {{ block.settings.star_color }};
  }

  @media (max-width: 767px) {
    #shopify-block-{{ block.id }} {
      margin: {{ block.settings.margin_top_mobile }}px {{ block.settings.margin_right_mobile }}px {{ block.settings.margin_bottom_mobile }}px {{ block.settings.margin_left_mobile }}px;
      padding: {{ block.settings.padding_top_mobile }}px {{ block.settings.padding_right_mobile }}px {{ block.settings.padding_bottom_mobile }}px {{ block.settings.padding_left_mobile }}px; 
      {%- if block.settings.custom_width_mobile != blank -%}
        width: {{ block.settings.custom_width_mobile }}px;
      {%- elsif block.settings.width_mobile > 0 -%}
        width: {{ block.settings.width_mobile }}px;
      {%- endif -%}
    }
  }
{%- endstyle -%}


<div class="product-rating-stars">
  <svg class="star-svg" width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
    <mask id="mask0_114_10" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="-1" y="-1" width="20" height="20">
      <path d="M9.00008 0L11.7811 5.92429L18.0001 6.88013L13.5001 11.489L14.5621 18L9.00008 14.9243L3.43808 18L4.50008 11.489L7.89642e-05 6.88013L6.21908 5.92429L9.00008 0Z" fill="black" stroke="black" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round"/>
    </mask>
    <g mask="url(#mask0_114_10)">
    <path d="M9 0L11.781 5.92429L18 6.88013L13.5 11.489L14.562 18L9 14.9243L3.438 18L4.5 11.489L0 6.88013L6.219 5.92429L9 0Z" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round"/>
    <rect class="star-indicator" width="18" height="18" fill="currentColor"/>
    </g>
  </svg>
  <span class="rating">
    {%- if block.settings.product.metafields.custom.rating.value != blank -%}
      {{ block.settings.product.metafields.custom.rating.value }}
    {%- else -%}
      5.0
    {%- endif -%}
  </span>
  <span class="total-reviews">({{ total_reviews }})</span>
</div>


{% schema %}
  {
    "name": "Product Rating",
    "class": "product-rating-block",
    "settings": [
      {
        "type": "header",
        "content": "Dynamic Data"
      },
      {
        "type": "product",
        "id": "product",
        "label": "Product Data"
      },
      {
        "type": "color",
        "id": "star_color",
        "label": "Star Color",
        "default": "#fdc702"
      },
      {
        "type": "color",
        "id": "text_color",
        "label": "Text Color",
        "default": "#535353"
      },
      {
        "type": "header",
        "content": "General Settings"
      },
      {
        "type": "number",
        "id": "width_desktop",
        "label": "Width (Desktop)",
        "default": 0
      },
      {
        "type": "text",
        "id": "custom_width_desktop",
        "label": "Custom Width (Desktop)"
      },
      {
        "type": "number",
        "id": "min_height_desktop",
        "label": "Minimum Height",
        "default": 0
      },
      {
        "type": "number",
        "id": "width_mobile",
        "label": "Width (Mobile)",
        "default": 0
      },
      {
        "type": "text",
        "id": "custom_width_mobile",
        "label": "Custom Width (Mobile)"
      },
      {
        "type": "number",
        "id": "min_height_mobile",
        "label": "Minimum Height",
        "default": 0
      },
      {
        "type": "header",
        "content": "Margin"
      },
      {
        "type": "number",
        "id": "margin_top_desktop",
        "label": "Margin Top (Desktop)",
        "default": 0
      },
      {
        "type": "number",
        "id": "margin_bottom_desktop",
        "label": "Margin Bottom (Desktop)",
        "default": 0
      },
      {
        "type": "number",
        "id": "margin_left_desktop",
        "label": "Margin Left (Desktop)",
        "default": 0
      },
      {
        "type": "number",
        "id": "margin_right_desktop",
        "label": "Margin Right (Desktop)",
        "default": 0
      },
      {
        "type": "number",
        "id": "margin_top_mobile",
        "label": "Margin Top (Mobile)",
        "default": 0
      },
      {
        "type": "number",
        "id": "margin_bottom_mobile",
        "label": "Margin Bottom (Mobile)",
        "default": 0
      },
      {
        "type": "number",
        "id": "margin_left_mobile",
        "label": "Margin Left (Mobile)",
        "default": 0
      },
      {
        "type": "number",
        "id": "margin_right_mobile",
        "label": "Margin Right (Mobile)",
        "default": 0
      },
      {
        "type": "header",
        "content": "Padding"
      },
      {
        "type": "number",
        "id": "padding_top_desktop",
        "label": "Padding Top (Desktop)",
        "default": 0
      },
      {
        "type": "number",
        "id": "padding_bottom_desktop",
        "label": "Padding Bottom (Desktop)",
        "default": 0
      },
      {
        "type": "number",
        "id": "padding_left_desktop",
        "label": "Padding Left (Desktop)",
        "default": 0
      },
      {
        "type": "number",
        "id": "padding_right_desktop",
        "label": "Padding Right (Desktop)",
        "default": 0
      },
      {
        "type": "number",
        "id": "padding_top_mobile",
        "label": "Padding Top (Mobile)",
        "default": 0
      },
      {
        "type": "number",
        "id": "padding_bottom_mobile",
        "label": "Padding Bottom (Mobile)",
        "default": 0
      },
      {
        "type": "number",
        "id": "padding_left_mobile",
        "label": "Padding Left (Mobile)",
        "default": 0
      },
      {
        "type": "number",
        "id": "padding_right_mobile",
        "label": "Padding Right (Mobile)",
        "default": 0
      },
    ],
    "presets": [
      {
        "name": "Product Rating"
      }
    ]
  }
{% endschema %}